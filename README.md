# Marketplace Backend

### Overview

Technologies used: Nodejs, Postgres, elasticsearch

Basic ecommerce backend. The project has CRUD operations for sellers and products. User(buyer/customer) interaction is limited to adding items to a cart. Reports generation is only for number of times a product is added to a cart which can be generated by date range.

### Usage

#### 1. Install dependencies

```javascript
npm i
```

#### 2. Edit .env file

#### 3. Run server

```javascript
npm start
```

## API List

### Sellers

A seller has only two attributes, a "name" for description and "email" as uniqe identifier.

| Enpoint         | Description       | options                                |
| --------------- | ----------------- | -------------------------------------- |
| GET /sellers    | List sellers      | ?sort (string)                         |
|                 |                   | ?filter(array)                         |
|                 |                   | ?limit (integer)                       |
|                 |                   | ?offset (integer)                      |
| GET /seller/:id | Fetch seller      | params : \*id (integer) - seller Id    |
| POST /seller    | Create new seller | body : \*name (string)                 |
|                 |                   | body : \*email (string)                |
| PUT /seller     | Update seller     | body : \*id (integer) - seller id      |
|                 |                   | body : \*opts (object) - {name, email} |

### Products

A product is owned by a seller. Upserting a product requires you to specify a seller.

| Enpoint          | Description       | options                                                       |
| ---------------- | ----------------- | ------------------------------------------------------------- |
| GET /products    | List products     | ?sort (string)                                                |
|                  |                   | ?filter(array)                                                |
|                  |                   | ?limit (integer)                                              |
|                  |                   | ?offset (integer)                                             |
| GET /product/:id | Fetch product     | params : \*id (integer) - seller Id                           |
| POST /product    | Create new seller | body : \*name (string)                                        |
|                  |                   | body : \*description (text)                                   |
|                  |                   | body : \*quantity (integer)                                   |
|                  |                   | body : \*price (string)                                       |
|                  |                   | body : \*sellerId (integer)                                   |
| PUT /seller      | Update seller     | body : \*id (integer) - seller id                             |
|                  |                   | body : \*opts (object) - {name, description, quantity, price} |

### Search

Whenever a product is successfully added, an async call is fired to store the product to elasticsearch.

TODO: use pub/sub messaging for firing an index call to elasticsearch to ensure a successful indexing.

| Enpoint     | Description    | options                                                                                            |
| ----------- | -------------- | -------------------------------------------------------------------------------------------------- |
| GET /search | Search product | ?q (string) - name or description of product                                                       |
| GET /search | Search product | ?type (match, term, wildcard, prefix, range, text, missing) - type of search [ default : "match" ] |

### Cart

When a user is added, a cart is also added referenced to the user.

When a user adds x number of item in a cart, a transaction is fired to the database to first check if the quantity is enough. If it is, the cart is updated. Else an error will be thrown.

| Enpoint    | Description           | options                     |
| ---------- | --------------------- | --------------------------- |
| POST /cart | update item on a cart | body: id (number) - cart id |
|            |                       | body: productId (number)    |
|            |                       | body: quantity (number)     |

### Report

Whenever a user successfully updates a cart, an async operation to log is fired. Each log is group per day.

TODO: generate report by datetime for a more accurate report for peak hours or promos for a time period.

| Enpoint                        | Description                            | options                                      |
| ------------------------------ | -------------------------------------- | -------------------------------------------- |
| GET /reports/product/cartCount | generate cart count report of products | ?startDate(string) [ default: current date ] |
|                                |                                        | ?endDate(string) [ default: current date ]   |
